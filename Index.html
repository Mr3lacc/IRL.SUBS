<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>üé§ IRL.SUBS ‚Äî Live Voice-to-Text Ticker</title>
   <style>
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
       }

       body {
           font-family: 'Arial', sans-serif;
           overflow: hidden;
           background: #000;
           color: #fff;
           height: 100vh;
           display: flex;
           flex-direction: column;
       }

       /* Theme Styles */
       .theme-basic {
           background: #000;
           color: #fff;
       }

       .theme-neon {
           background: #0a0a0f;
           color: #00ff41;
           text-shadow: 0 0 10px #00ff41, 0 0 20px #00ff41, 0 0 30px #00ff41;
       }

       .theme-blackwhite {
           background: #fff;
           color: #000;
       }

       .theme-comic {
           font-family: 'Comic Sans MS', cursive, sans-serif;
           background: #ffeb3b;
           color: #e91e63;
       }

       .theme-morse {
           font-family: 'Courier New', monospace;
           background: #1a1a1a;
           color: #00ff00;
           letter-spacing: 0.2em;
       }

       /* Settings Panel (Portrait) */
       .settings-panel {
           display: flex;
           flex-direction: column;
           padding: 20px;
           gap: 15px;
           background: rgba(0,0,0,0.9);
           color: #fff;
           max-width: 400px;
           margin: 0 auto;
           border-radius: 10px;
           margin-top: 20px;
       }

       .settings-panel h1 {
           text-align: center;
           font-size: 1.5em;
           margin-bottom: 10px;
       }

       .control-group {
           display: flex;
           flex-direction: column;
           gap: 8px;
       }

       .control-group label {
           font-weight: bold;
           font-size: 0.9em;
       }

       .control-group select,
       .control-group input {
           padding: 10px;
           border: none;
           border-radius: 5px;
           background: #333;
           color: #fff;
           font-size: 1em;
       }

       .button {
           padding: 15px;
           border: none;
           border-radius: 8px;
           font-size: 1.1em;
           font-weight: bold;
           cursor: pointer;
           transition: all 0.3s ease;
       }

       .start-btn {
           background: #4CAF50;
           color: white;
       }

       .start-btn:hover {
           background: #45a049;
       }

       .stop-btn {
           background: #f44336;
           color: white;
       }

       .stop-btn:hover {
           background: #da190b;
       }

       .clear-btn {
           background: #ff9800;
           color: white;
       }

       .clear-btn:hover {
           background: #e68900;
       }

       /* Ticker Display (Landscape) */
       .ticker-container {
           display: none;
           height: 100vh;
           width: 100vw;
           position: relative;
           overflow: hidden;
           justify-content: center;
           align-items: center;
       }

       .ticker-text {
           white-space: nowrap;
           font-size: 4em;
           font-weight: bold;
           animation: scroll-left 20s linear infinite;
           position: absolute;
           width: max-content;
       }

       .ticker-text.outlined {
           text-shadow: 
               -2px -2px 0 #000,
               2px -2px 0 #000,
               -2px 2px 0 #000,
               2px 2px 0 #000;
       }

       @keyframes scroll-left {
           0% {
               transform: translateX(100vw);
           }
           100% {
               transform: translateX(-100%);
           }
       }

       /* Status indicators */
       .status {
           position: fixed;
           top: 20px;
           right: 20px;
           background: rgba(0,0,0,0.7);
           padding: 10px;
           border-radius: 5px;
           font-size: 0.9em;
       }

       .listening {
           color: #4CAF50;
       }

       .stopped {
           color: #f44336;
       }

       /* Instructions */
       .instructions {
           margin-top: 20px;
           padding: 15px;
           background: rgba(255,255,255,0.1);
           border-radius: 8px;
           font-size: 0.9em;
           line-height: 1.4;
       }

       /* Responsive adjustments */
       @media (orientation: landscape) {
           .settings-panel {
               display: none;
           }
           
           .ticker-container {
               display: flex;
           }

           .ticker-text {
               font-size: 6vmin;
           }
       }

       @media (orientation: portrait) {
           .settings-panel {
               display: flex;
           }
           
           .ticker-container {
               display: none;
           }
       }
   </style>
</head>
<body class="theme-basic">

   <!-- Settings Panel (Portrait Mode) -->
   <div class="settings-panel">
       <h1>üé§ IRL.SUBS</h1>
       <p style="text-align: center; opacity: 0.8;">Live Voice-to-Text Ticker</p>

       <div class="control-group">
           <label for="theme-select">üé® Visual Theme</label>
           <select id="theme-select">
               <option value="basic">Basic (Black & White)</option>
               <option value="neon">Neon Green</option>
               <option value="blackwhite">High Contrast B&W</option>
               <option value="comic">Comic Sans Fun</option>
               <option value="morse">Morse Code Style</option>
           </select>
       </div>

       <div class="control-group">
           <label for="scroll-speed">‚ö° Scroll Speed</label>
           <input type="range" id="scroll-speed" min="5" max="30" value="20" step="1">
           <span id="speed-value">20s per cycle</span>
       </div>

       <div class="control-group">
           <label for="language-select">üåç Language</label>
           <select id="language-select">
               <option value="en-US">English (US)</option>
               <option value="en-GB">English (UK)</option>
               <option value="es-ES">Spanish</option>
               <option value="fr-FR">French</option>
               <option value="de-DE">German</option>
               <option value="it-IT">Italian</option>
               <option value="pt-BR">Portuguese</option>
               <option value="ja-JP">Japanese</option>
               <option value="ko-KR">Korean</option>
               <option value="zh-CN">Chinese</option>
               <option value="ar-SA">Arabic</option>
               <option value="hi-IN">Hindi</option>
               <option value="ru-RU">Russian</option>
           </select>
       </div>

       <div class="control-group">
           <label for="font-family">üî§ Font Family</label>
           <select id="font-family">
               <option value="Arial">Arial</option>
               <option value="'Times New Roman'">Times New Roman</option>
               <option value="'Comic Sans MS'">Comic Sans MS</option>
               <option value="'Courier New'">Courier New</option>
               <option value="'Impact'">Impact</option>
               <option value="'Georgia'">Georgia</option>
               <option value="'Verdana'">Verdana</option>
               <option value="'Trebuchet MS'">Trebuchet MS</option>
               <option value="'Helvetica'">Helvetica</option>
               <option value="'Lucida Console'">Lucida Console</option>
           </select>
       </div>

       <div class="control-group">
           <label for="font-size">üìè Font Size</label>
           <input type="range" id="font-size" min="2" max="12" value="6" step="0.5">
           <span id="font-size-value">6vmin</span>
       </div>

       <div class="control-group">
           <label>üìù Font Style</label>
           <div style="display: flex; gap: 10px; flex-wrap: wrap;">
               <div style="display: flex; align-items: center; gap: 5px;">
                   <input type="checkbox" id="font-bold">
                   <label for="font-bold" style="font-weight: normal;">Bold</label>
               </div>
               <div style="display: flex; align-items: center; gap: 5px;">
                   <input type="checkbox" id="font-italic">
                   <label for="font-italic" style="font-weight: normal;">Italic</label>
               </div>
               <div style="display: flex; align-items: center; gap: 5px;">
                   <input type="checkbox" id="font-underline">
                   <label for="font-underline" style="font-weight: normal;">Underline</label>
               </div>
           </div>
       </div>

       <div class="control-group">
           <label for="text-color">üé® Text Color</label>
           <div style="display: flex; gap: 10px; align-items: center;">
               <input type="color" id="text-color" value="#ffffff" style="width: 50px; height: 40px; border: none; border-radius: 5px;">
               <select id="color-presets">
                   <option value="">Color Presets</option>
                   <option value="#ffffff">White</option>
                   <option value="#00ff41">Matrix Green</option>
                   <option value="#ff0040">Hot Pink</option>
                   <option value="#00ffff">Cyan</option>
                   <option value="#ffff00">Yellow</option>
                   <option value="#ff8000">Orange</option>
                   <option value="#8000ff">Purple</option>
                   <option value="#ff0000">Red</option>
                   <option value="#0080ff">Blue</option>
               </select>
           </div>
       </div>

       <div class="control-group">
           <label for="bg-color">üñºÔ∏è Background Color</label>
           <div style="display: flex; gap: 10px; align-items: center;">
               <input type="color" id="bg-color" value="#000000" style="width: 50px; height: 40px; border: none; border-radius: 5px;">
               <select id="bg-presets">
                   <option value="">Background Presets</option>
                   <option value="#000000">Black</option>
                   <option value="#ffffff">White</option>
                   <option value="#0a0a0f">Dark Blue</option>
                   <option value="#1a1a1a">Dark Gray</option>
                   <option value="#800080">Purple</option>
                   <option value="#004000">Dark Green</option>
                   <option value="#400000">Dark Red</option>
                   <option value="#000040">Navy</option>
               </select>
           </div>
       </div>

       <div class="control-group">
           <label>‚ôø Accessibility & Effects</label>
           <div style="display: flex; gap: 10px; flex-wrap: wrap;">
               <div style="display: flex; align-items: center; gap: 5px;">
                   <input type="checkbox" id="text-outline">
                   <label for="text-outline" style="font-weight: normal;">Text Outline</label>
               </div>
               <div style="display: flex; align-items: center; gap: 5px;">
                   <input type="checkbox" id="text-shadow">
                   <label for="text-shadow" style="font-weight: normal;">Text Shadow</label>
               </div>
               <div style="display: flex; align-items: center; gap: 5px;">
                   <input type="checkbox" id="text-glow">
                   <label for="text-glow" style="font-weight: normal;">Neon Glow</label>
               </div>
           </div>
       </div>

       <button class="button start-btn" id="start-btn">üéôÔ∏è Start Listening</button>
       <button class="button stop-btn" id="stop-btn" style="display: none;">‚èπÔ∏è Stop</button>
       <button class="button clear-btn" id="clear-btn">üóëÔ∏è Clear Text</button>

       <div class="instructions">
           <strong>üìã Instructions:</strong><br>
           ‚Ä¢ <strong>IMPORTANT:</strong> Allow microphone access when prompted!<br>
           ‚Ä¢ Rotate to landscape for fullscreen ticker<br>
           ‚Ä¢ Volume ‚¨áÔ∏è = Repeat last phrase<br>
           ‚Ä¢ Volume ‚¨ÜÔ∏è = Skip/Clear wrong words<br>
           ‚Ä¢ Works best in quiet environments<br>
           ‚Ä¢ Use Chrome/Edge/Safari for best results
       </div>
   </div>

   <!-- Ticker Display (Landscape Mode) -->
   <div class="ticker-container">
       <div class="ticker-text" id="ticker-text">üé§ IRL.SUBS Ready - Start speaking...</div>
   </div>

   <!-- Status Indicator -->
   <div class="status" id="status">
       <span class="stopped">‚óè Stopped</span>
   </div>

   <script>
       let recognition;
       let isListening = false;
       let currentText = '';
       let lastPhrase = '';
       let scrollSpeed = 20;
       let currentLanguage = 'en-US';
       let currentFontFamily = 'Arial';
       let currentFontSize = 6;
       let currentTextColor = '#ffffff';
       let currentBgColor = '#000000';

       // DOM Elements
       const startBtn = document.getElementById('start-btn');
       const stopBtn = document.getElementById('stop-btn');
       const clearBtn = document.getElementById('clear-btn');
       const themeSelect = document.getElementById('theme-select');
       const speedSlider = document.getElementById('scroll-speed');
       const speedValue = document.getElementById('speed-value');
       const languageSelect = document.getElementById('language-select');
       const fontFamilySelect = document.getElementById('font-family');
       const fontSizeSlider = document.getElementById('font-size');
       const fontSizeValue = document.getElementById('font-size-value');
       const fontBold = document.getElementById('font-bold');
       const fontItalic = document.getElementById('font-italic');
       const fontUnderline = document.getElementById('font-underline');
       const textColorPicker = document.getElementById('text-color');
       const bgColorPicker = document.getElementById('bg-color');
       const colorPresets = document.getElementById('color-presets');
       const bgPresets = document.getElementById('bg-presets');
       const textOutline = document.getElementById('text-outline');
       const textShadow = document.getElementById('text-shadow');
       const textGlow = document.getElementById('text-glow');
       const tickerText = document.getElementById('ticker-text');
       const status = document.getElementById('status');

       // Initialize Speech Recognition
       function initSpeechRecognition() {
           if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
               alert('Speech recognition not supported in this browser. Please use Chrome, Edge, or Safari.');
               return false;
           }

           const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
           recognition = new SpeechRecognition();
           
           // More aggressive settings for better recognition
           recognition.continuous = true;
           recognition.interimResults = true;
           recognition.lang = currentLanguage;
           recognition.maxAlternatives = 1;
           
           recognition.onstart = () => {
               console.log('üé§ Speech recognition started');
               isListening = true;
               updateStatus(true);
               // Visual feedback
               startBtn.textContent = 'üî¥ LISTENING...';
           };

           recognition.onresult = (event) => {
               console.log('üéØ Got speech result:', event);
               let interimTranscript = '';
               let finalTranscript = '';

               for (let i = event.resultIndex; i < event.results.length; i++) {
                   const transcript = event.results[i][0].transcript;
                   console.log('Transcript:', transcript, 'isFinal:', event.results[i].isFinal);
                   
                   if (event.results[i].isFinal) {
                       finalTranscript += transcript + ' ';
                   } else {
                       interimTranscript += transcript;
                   }
               }

               // Show interim results immediately for faster feedback
               if (interimTranscript || finalTranscript) {
                   const displayText = currentText + finalTranscript + interimTranscript;
                   tickerText.textContent = displayText || 'üé§ IRL.SUBS Ready - Start speaking...';
               }

               if (finalTranscript) {
                   currentText += finalTranscript;
                   lastPhrase = finalTranscript.trim();
                   updateTicker();
                   console.log('‚úÖ Added to ticker:', finalTranscript);
               }
           };

           recognition.onspeechstart = () => {
               console.log('üó£Ô∏è Speech detected');
           };

           recognition.onsoundstart = () => {
               console.log('üîä Sound detected');
           };

           recognition.onerror = (event) => {
               console.error('‚ùå Speech recognition error:', event.error, event);
               
               if (event.error === 'not-allowed') {
                   alert('‚ùå Microphone access denied!\n\n1. Click the üîí lock icon in your address bar\n2. Allow microphone access\n3. Refresh the page');
                   updateStatus(false);
               } else if (event.error === 'no-speech') {
                   console.log('‚ö†Ô∏è No speech detected, continuing...');
                   // Don't stop for no-speech, just continue
               } else if (event.error === 'network') {
                   alert('‚ùå Network error. Check your internet connection.');
               } else {
                   console.log('‚ö†Ô∏è Recognition error:', event.error, '- trying to restart...');
               }
           };

           recognition.onend = () => {
               console.log('‚èπÔ∏è Speech recognition ended');
               if (isListening) {
                   console.log('üîÑ Restarting recognition...');
                   // Restart immediately if we're still supposed to be listening
                   setTimeout(() => {
                       try {
                           recognition.start();
                       } catch (e) {
                           console.error('Failed to restart recognition:', e);
                       }
                   }, 100);
               } else {
                   startBtn.textContent = 'üéôÔ∏è Start Listening';
               }
           };

           return true;
       }

       // Update ticker styling
       function updateTickerStyling() {
           tickerText.style.fontFamily = currentFontFamily;
           tickerText.style.fontSize = currentFontSize + 'vmin';
           tickerText.style.color = currentTextColor;
           tickerText.style.fontWeight = fontBold.checked ? 'bold' : 'normal';
           tickerText.style.fontStyle = fontItalic.checked ? 'italic' : 'normal';
           tickerText.style.textDecoration = fontUnderline.checked ? 'underline' : 'none';
           
           // Background color
           document.body.style.background = currentBgColor;
           
           // Text effects
           let textShadowCSS = '';
           if (textOutline.checked) {
               textShadowCSS += `-2px -2px 0 ${currentBgColor}, 2px -2px 0 ${currentBgColor}, -2px 2px 0 ${currentBgColor}, 2px 2px 0 ${currentBgColor}`;
           }
           if (textShadow.checked) {
               if (textShadowCSS) textShadowCSS += ', ';
               textShadowCSS += `4px 4px 8px rgba(0,0,0,0.8)`;
           }
           if (textGlow.checked) {
               if (textShadowCSS) textShadowCSS += ', ';
               textShadowCSS += `0 0 10px ${currentTextColor}, 0 0 20px ${currentTextColor}, 0 0 30px ${currentTextColor}`;
           }
           
           tickerText.style.textShadow = textShadowCSS;
       }

       // Update scroll animation speed
       function updateScrollAnimation() {
           tickerText.style.animationDuration = scrollSpeed + 's';
       }

       // Update ticker text
       function updateTicker() {
           tickerText.textContent = currentText || 'üé§ IRL.SUBS Ready - Start speaking...';
           updateScrollAnimation();
           updateTickerStyling();
       }

       // Update status indicator
       function updateStatus(listening) {
           if (listening) {
               status.innerHTML = '<span class="listening">‚óè Listening</span>';
           } else {
               status.innerHTML = '<span class="stopped">‚óè Stopped</span>';
           }
       }

       // Theme switching
       function changeTheme(theme) {
           document.body.className = `theme-${theme}`;
       }

       // Start listening
       async function startListening() {
           console.log('üöÄ Starting listening process...');
           
           // First, request microphone permission explicitly
           try {
               const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
               console.log('‚úÖ Microphone permission granted');
               stream.getTracks().forEach(track => track.stop()); // Stop the stream, we just needed permission
           } catch (error) {
               console.error('‚ùå Microphone permission denied:', error);
               alert('‚ùå Please allow microphone access:\n\n1. Click "Allow" when prompted\n2. Or click the üîí in your address bar\n3. Set microphone to "Allow"\n4. Refresh the page');
               return;
           }

           if (!recognition && !initSpeechRecognition()) {
               return;
           }

           try {
               recognition.lang = currentLanguage;
               recognition.start();
               startBtn.style.display = 'none';
               stopBtn.style.display = 'block';
               console.log('üé§ Recognition started successfully');
           } catch (error) {
               console.error('‚ùå Failed to start recognition:', error);
               alert('‚ùå Failed to start speech recognition. Please refresh the page and try again.');
           }
       }

       // Stop listening
       function stopListening() {
           if (recognition) {
               isListening = false;
               recognition.stop();
           }
           updateStatus(false);
           startBtn.style.display = 'block';
           stopBtn.style.display = 'none';
       }

       // Clear text
       function clearText() {
           currentText = '';
           updateTicker();
       }

       // Repeat last phrase
       function repeatLastPhrase() {
           if (lastPhrase) {
               currentText += ' [REPEAT: ' + lastPhrase + '] ';
               updateTicker();
           }
       }

       // Skip/clear wrong words
       function skipWords() {
           // Remove last 10 characters or last word
           const words = currentText.trim().split(' ');
           if (words.length > 1) {
               words.pop();
               currentText = words.join(' ') + ' ';
               updateTicker();
           }
       }

       // Event Listeners
       startBtn.addEventListener('click', startListening);
       stopBtn.addEventListener('click', stopListening);
       clearBtn.addEventListener('click', clearText);

       themeSelect.addEventListener('change', (e) => {
           changeTheme(e.target.value);
       });

       speedSlider.addEventListener('input', (e) => {
           scrollSpeed = e.target.value;
           speedValue.textContent = scrollSpeed + 's per cycle';
           updateScrollAnimation();
       });

       languageSelect.addEventListener('change', (e) => {
           currentLanguage = e.target.value;
           if (recognition) {
               recognition.lang = currentLanguage;
           }
       });

       // Font controls
       fontFamilySelect.addEventListener('change', (e) => {
           currentFontFamily = e.target.value;
           updateTickerStyling();
       });

       fontSizeSlider.addEventListener('input', (e) => {
           currentFontSize = e.target.value;
           fontSizeValue.textContent = currentFontSize + 'vmin';
           updateTickerStyling();
       });

       fontBold.addEventListener('change', updateTickerStyling);
       fontItalic.addEventListener('change', updateTickerStyling);
       fontUnderline.addEventListener('change', updateTickerStyling);

       // Color controls
       textColorPicker.addEventListener('input', (e) => {
           currentTextColor = e.target.value;
           updateTickerStyling();
       });

       bgColorPicker.addEventListener('input', (e) => {
           currentBgColor = e.target.value;
           updateTickerStyling();
       });

       colorPresets.addEventListener('change', (e) => {
           if (e.target.value) {
               currentTextColor = e.target.value;
               textColorPicker.value = e.target.value;
               updateTickerStyling();
               e.target.value = ''; // Reset dropdown
           }
       });

       bgPresets.addEventListener('change', (e) => {
           if (e.target.value) {
               currentBgColor = e.target.value;
               bgColorPicker.value = e.target.value;
               updateTickerStyling();
               e.target.value = ''; // Reset dropdown
           }
       });

       // Effect toggles
       textOutline.addEventListener('change', updateTickerStyling);
       textShadow.addEventListener('change', updateTickerStyling);
       textGlow.addEventListener('change', updateTickerStyling);

       // Hardware button support (Volume buttons)
       document.addEventListener('keydown', (e) => {
           // Volume Down (or Down Arrow) - Repeat last phrase
           if (e.key === 'ArrowDown' || e.key === 'VolumeDown') {
               e.preventDefault();
               repeatLastPhrase();
           }
           
           // Volume Up (or Up Arrow) - Skip/clear wrong words
           if (e.key === 'ArrowUp' || e.key === 'VolumeUp') {
               e.preventDefault();
               skipWords();
           }

           // Space bar - Toggle listening
           if (e.key === ' ') {
               e.preventDefault();
               if (isListening) {
                   stopListening();
               } else {
                   startListening();
               }
           }

           // Escape - Clear text
           if (e.key === 'Escape') {
               e.preventDefault();
               clearText();
           }
       });

       // Initialize
       updateTicker();
       updateScrollAnimation();
       updateTickerStyling();

       // Handle orientation changes
       window.addEventListener('orientationchange', () => {
           setTimeout(() => {
               updateScrollAnimation();
           }, 500);
       });

       // Request microphone permissions on load and test
       if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
           navigator.mediaDevices.getUserMedia({ audio: true })
               .then((stream) => {
                   console.log('‚úÖ Microphone access granted on load');
                   stream.getTracks().forEach(track => track.stop());
                   // Add a test button if needed
                   const testBtn = document.createElement('button');
                   testBtn.textContent = 'üß™ Test Microphone';
                   testBtn.className = 'button';
                   testBtn.style.background = '#2196F3';
                   testBtn.onclick = () => {
                       if (!isListening) {
                           startListening();
                       }
                   };
                   document.querySelector('.settings-panel').appendChild(testBtn);
               })
               .catch((error) => {
                   console.log('‚ùå Microphone access denied on load:', error);
                   // Show warning
                   const warning = document.createElement('div');
                   warning.style.cssText = 'background: #ff5722; color: white; padding: 10px; border-radius: 5px; margin-top: 10px; text-align: center;';
                   warning.innerHTML = '‚ö†Ô∏è <strong>Microphone access needed!</strong><br>Click "Allow" when you start listening.';
                   document.querySelector('.settings-panel').appendChild(warning);
               });
       } else {
           console.log('‚ùå getUserMedia not supported');
           alert('‚ùå Your browser doesn\'t support microphone access. Please use Chrome, Edge, or Safari.');
       }
   </script>

</body>
</html>
